:ruby
  max_height = local_assigns.has_key?(:max_height) ? max_height : 360
  width      = local_assigns.has_key?(:width) ? width : 80
  labels     = local_assigns.has_key?(:labels) ? labels : true
  max_amount = local_assigns.has_key?(:max_amount) ? max_amount : Scenario::MaxAmount
  rounded_sum = 0
  current_chart_height = scenario.total_amount / max_amount.to_f * max_height
.full_chart
  %header
    #{scenario.name} - Energy Mix van #{END_YEAR}
  %section.chart
    %header
      Kosten &euro;XXXXX Miljard    
    .charts_container
      .chart_canvas_mix{:style=>"width: #{width}px;"}
        %ul.chart
          - scenario.carriers.each_pair do |key, v|
            - height = (v[:ratio] * current_chart_height).round
            - rounded_sum += height
            - label_hidden = height <= 10
            %li.serie{:class => [key, Scenario::PrimaryMixTable[key]], :style => "height: #{height}px", :title => I18n.t(key)}
              - if labels
                %span.label{:class => label_hidden ? 'hidden' : ''}= I18n.t(key)
      .renewables_float
        %ul.chart
          - scenario.renewable_carriers.each_pair do |key, v|
            - height = v[:relative_ratio] * 200
            %li.serie{:class => [key, Scenario::SecondaryMixTable[key]], :style => "height: #{height}px", :title => I18n.t(key)}
              %span.label{:class => height <= 5 ? 'hidden' : ''}= I18n.t(key)
  %section.boxes
    %header Effect
    - [:output_5, :output_6, :output_7, :output_8].each do |o|
      .dashboard_item{:class => set_class_for_output(o, scenario.send(o))}
        %h3= raw t(dashboard_label_for_output(o))
        .value= format_dashboard_value o, scenario.send(o)
  .clear
