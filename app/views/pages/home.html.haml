-#TODO: Cut these pieces into partials
%section#questions
  %nav
    -@questions.each do |question|
      %a{:id => question.id, :href=>"#"}
        =question.number

  = form_tag home_path, :method => :get, :remote => true do
    - @questions.each do |question|
      .question{:id=>"question_#{question.number}"}
        .number
          = question.number
        .question_text
          = question.question
        .answers
          - question.answers.each do |answer|
            .answer
              %input{:name => "question_#{question.id}", 
                     :type => "radio", 
                     :value => answer.id, 
                     :id => "answer_#{answer.id}"}
              %label{:for => "answer_#{answer.id}"}
                %span.letter
                  = answer.letter
                %span.answer_text
                  = answer.answer

    %input{:type => "submit"}
  %nav
    %a{:href=>"#", :id=>"previous_question"}
      previous        
    %a{:href=>"#", :id=>"next_question"}
      next

%script{:type => "text/javascript"}
  $(".question").not("#question_1").hide();

%section#results
  %section{:class=>"output"}
    %table
      %tr
        %th Energy carrier
        %th Value
      -{coal: "total_cost_of_primary_natural_gas", natural_gas: "total_cost_of_primary_coal", total_cost_of_primary_oil: "total_cost_of_primary_oil", total_cost_of_primary_nuclear: "total_cost_of_primary_nuclear"}.each do |carrier, gquery|
        %tr
          %td=carrier
          %td{:gquery => gquery, :class=>"output"}
            loading...

  %section{:class=>"output"}
    %table
      %tr
        %th Indicator
        %th Value
      -{CO2: "co2_emission", sustainability: "share_of_renewable_energy", bio_footprint: "area_footprint_per_nl", net_energy_import: "energy_dependence"}.each do |carrier, gquery|
        %tr
          %td=carrier
          %td{:gquery => gquery, :class=>"output"}
            loading...

- content_for(:head) do
  = javascript_include_tag 'home'
  :javascript
    mixer = new Mixer();
    mixer.base_path = "#{Rails.configuration.api_base_path}";
    mixer.session_settings = #{options_for_javascript(Rails.configuration.api_session_settings)};

    mixer.new_session();

:javascript
  $(function() {
    $("form").bind("ajax:success", function(event, data, status, xhr) { eval($(data).text()) });

    $("form").submit(function(event) {
      $("#results .output .output").html("loading...");
    });
    $("input").change(function(event) { $("form").submit() });

    $("form").submit()
  });
