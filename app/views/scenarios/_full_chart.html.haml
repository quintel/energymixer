:ruby
  max_height = local_assigns.has_key?(:max_height) ? max_height : 360
  width      = local_assigns.has_key?(:width) ? width : 80
  max_amount = local_assigns.has_key?(:max_amount) ? max_amount : Scenario::MaxAmount
  rounded_sum = 0
  current_chart_height = scenario.total_amount / max_amount * 1_000_000_000 * max_height
  dashboard_items = {
    output_5: "co2_emission_percent_change_from_1990_corrected_for_electricity_import",
    output_6: "share_of_renewable_energy",
    output_7: "area_footprint_per_nl",
    output_8: "energy_dependence",
  }
.full_chart
  %header
    - if scenario.name
      #{scenario.name} - 
    - else
      Uw
    Energy Mix van #{@end_year}
  %section.chart
    %header
      Kosten &euro;
      %span.total_amount 
        = number_with_precision(scenario.total_amount, :precision => 1, :separator => ".")
      Miljard    
    .charts_container
      .legend
        %h4 Legenda
        %table
          - scenario.carriers.each_pair do |key, value|
            %tr{:class => [key, "costs_share_of_#{key}"]}
              %td= image_tag "layout/textures/#{key}.png"
              %td= t(key)
              %td.value= number_to_percentage value[:ratio] * 100, :precision => 0
          
      .chart_canvas_mix{:style=>"width: #{width}px;"}
        %ul.chart
          - scenario.carriers.each_pair do |key, v|
            - height = (v[:ratio] * current_chart_height).round
            - rounded_sum += height
            %li.serie{:class => [key, Scenario::PrimaryMixTable[key]], :style => "height: #{height}px", :title => I18n.t(key)}
      = render 'renewables_float', :scenario => scenario    

  %section.boxes
    %header Effect
    - dashboard_items.each_pair do |o, gquery|
      .dashboard_item{:id => gquery}
        .gauge_icon{:class => set_class_for_output(o, scenario.send(o))}
        .info_icon
          = image_tag('icons/i.png')
        %h3= raw t(dashboard_label_for_output(o))
        .value= format_dashboard_value o, scenario.send(o)
  .clear
  
  %section#dashboard_popups
    .dashboard_popup.energy_dependence
      = link_to image_tag('icons/close.png'), '#', :class => 'close_popup'
      .title Import afhankelijkheid
      .text
        Hoeveel energie importeert Nederland uit het buitenland in 2030 als gevolg van uw keuzes? Hier staat welk percentage van alle gebruikte energie er geÃ¯mporteert wordt, na aftrek van de hoeveelheid energie die Nederland exporteert. De Nederlandse gasvoorraden nemen af, en dus neemt de import geleidelijk aan toe.
    .dashboard_popup.co2_emission_percent_change_from_1990_corrected_for_electricity_import
      = link_to image_tag('icons/close.png'), '#', :class => 'close_popup'
      .title Verandering CO2-uitstoot
      .text
        Hoe verandert de CO2-uitstoot in 2030 als gevolg van uw keuzes? Hier staat de verandering ten opzichte van de uitstoot in 1990.
    .dashboard_popup.share_of_renewable_energy
      = link_to image_tag('icons/close.png'), '#', :class => 'close_popup'
      .title Hernieuwbare energie
      .text
        Welk deel van het toekomstige energiegebruik is hernieuwbaar? We gebruiken hier de Europese definitie van hernieuwbare energie. Dat betekent dat we kijken welk percentage van het eindgebruik hernieuwbaar is.
    .dashboard_popup.area_footprint_per_nl
      = link_to image_tag('icons/close.png'), '#', :class => 'close_popup'
      .title Bio-voetafdruk
      .text
        Hoeveel landbouwoppervlak is er nodig in 2030 als gevolg van uw keuzes? Biomassa moet vaak geteeld worden. Hier ziet u hoeveel keer het Nederlandse landbouwareaal nodig is om dat te doen.
